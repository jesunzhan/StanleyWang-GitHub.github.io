<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2">























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon32.ico?v=7.0.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon16.ico?v=7.0.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.0.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="欢迎加入王导的VIP学习qq群：==&amp;gt;932194668&amp;lt;==   部署对象式存储minio运维主机HDSS7-200.host.com上： 准备docker镜像镜像下载地址12345678910111213141516[root@hdss7-200 ~]# docker pull minio/minio:latestlatest: Pulling from minio/minioe">
<meta property="og:type" content="article">
<meta property="og:title" content="实验文档5：企业级kubernetes容器云自动化运维平台">
<meta property="og:url" content="https://StanleyWang-GitHub.github.io/2019/01/18/实验文档5：企业级Kubernetes容器云自动化运维平台/index.html">
<meta property="og:site_name" content="Stanley&#39;s Blog">
<meta property="og:description" content="欢迎加入王导的VIP学习qq群：==&amp;gt;932194668&amp;lt;==   部署对象式存储minio运维主机HDSS7-200.host.com上： 准备docker镜像镜像下载地址12345678910111213141516[root@hdss7-200 ~]# docker pull minio/minio:latestlatest: Pulling from minio/minioe">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-05-22T06:29:27.399Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="实验文档5：企业级kubernetes容器云自动化运维平台">
<meta name="twitter:description" content="欢迎加入王导的VIP学习qq群：==&amp;gt;932194668&amp;lt;==   部署对象式存储minio运维主机HDSS7-200.host.com上： 准备docker镜像镜像下载地址12345678910111213141516[root@hdss7-200 ~]# docker pull minio/minio:latestlatest: Pulling from minio/minioe">






  <link rel="canonical" href="https://StanleyWang-GitHub.github.io/2019/01/18/实验文档5：企业级Kubernetes容器云自动化运维平台/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>实验文档5：企业级kubernetes容器云自动化运维平台 | Stanley's Blog</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Stanley's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://StanleyWang-GitHub.github.io/2019/01/18/实验文档5：企业级Kubernetes容器云自动化运维平台/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Stanley Wang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Stanley's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">实验文档5：企业级kubernetes容器云自动化运维平台

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-18 18:12:56" itemprop="dateCreated datePublished" datetime="2019-01-18T18:12:56+08:00">2019-01-18</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-22 14:29:27" itemprop="dateModified" datetime="2019-05-22T14:29:27+08:00">2019-05-22</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Kubernetes容器云技术专题/" itemprop="url" rel="index"><span itemprop="name">Kubernetes容器云技术专题</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">40k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">37 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <hr>
<blockquote class="blockquote-center"><p>欢迎加入王导的VIP学习qq群：==&gt;<a href="http://shang.qq.com/wpa/qunwpa?idkey=78869fddc5a661acb0639315eb52997c108de6625df5f0ee2f0372f176a032a6" target="_blank" rel="noopener"><font color="FF7F50">932194668</font></a>&lt;==</p>
</blockquote>
<hr>
<h1 id="部署对象式存储minio"><a href="#部署对象式存储minio" class="headerlink" title="部署对象式存储minio"></a>部署对象式存储minio</h1><p>运维主机<code>HDSS7-200.host.com</code>上：</p>
<h2 id="准备docker镜像"><a href="#准备docker镜像" class="headerlink" title="准备docker镜像"></a>准备docker镜像</h2><p><a href="https://hub.docker.com/r/minio/minio" target="_blank" rel="noopener">镜像下载地址</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@hdss7-200 ~]# docker pull minio/minio:latest</span><br><span class="line">latest: Pulling from minio/minio</span><br><span class="line">e7c96db7181b: Pull complete </span><br><span class="line">b17880043800: Pull complete </span><br><span class="line">e5fc8b080393: Pull complete </span><br><span class="line">3b5383aad564: Pull complete </span><br><span class="line">Digest: sha256:1a594faffab833866e43154c31b943d49ca1146d2c164ec3279382d7530d2ede</span><br><span class="line">Status: Downloaded newer image for minio/minio:latest</span><br><span class="line">[root@hdss7-200 ~]# docker tag ed5e2b2624bf harbor.od.com/spinnaker/minio:latest</span><br><span class="line">[root@hdss7-200 ~]# docker push harbor.od.com/spinnaker/minio:latest</span><br><span class="line">The push refers to a repository [harbor.od.com/spinnaker/minio]</span><br><span class="line">e8c528077536: Pushed </span><br><span class="line">ad774a44659e: Pushed </span><br><span class="line">1a734f934625: Pushed </span><br><span class="line">f1b5933fe4b5: Pushed </span><br><span class="line">latest: digest: sha256:a676c2f71ad261d10cba2527094810e8a37f98d79086694ec162cb7fea64f5e0 size: 1158</span><br></pre></td></tr></table></figure></p>
<h2 id="准备资源配置清单"><a href="#准备资源配置清单" class="headerlink" title="准备资源配置清单"></a>准备资源配置清单</h2><div class="tabs" id="minio"><ul class="nav-tabs"><li class="tab active"><a href="#minio-1">Deployment</a></li><li class="tab"><a href="#minio-2">Service</a></li><li class="tab"><a href="#minio-3">Ingress</a></li></ul><div class="tab-content"><div class="tab-pane active" id="minio-1"><p>vi /data/k8s-yaml/minio/deployment.yaml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">kind: Deployment</span><br><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    name: minio</span><br><span class="line">  name: minio</span><br><span class="line">  namespace: spinnaker</span><br><span class="line">spec:</span><br><span class="line">  progressDeadlineSeconds: 600</span><br><span class="line">  replicas: 1</span><br><span class="line">  revisionHistoryLimit: 7</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      name: minio</span><br><span class="line">  strategy:</span><br><span class="line">    rollingUpdate:</span><br><span class="line">      maxSurge: 1</span><br><span class="line">      maxUnavailable: 1</span><br><span class="line">    type: RollingUpdate</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: minio</span><br><span class="line">        name: minio</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - args:</span><br><span class="line">        - server</span><br><span class="line">        - /data</span><br><span class="line">        env:</span><br><span class="line">        - name: MINIO_ACCESS_KEY</span><br><span class="line">          value: admin</span><br><span class="line">        - name: MINIO_SECRET_KEY</span><br><span class="line">          value: poiuytrewq</span><br><span class="line">        image: harbor.od.com/spinnaker/minio:latest</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        name: minio</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 9000</span><br><span class="line">          protocol: TCP</span><br><span class="line">        readinessProbe:</span><br><span class="line">          failureThreshold: 3</span><br><span class="line">          httpGet:</span><br><span class="line">            path: /minio/health/ready</span><br><span class="line">            port: 9000</span><br><span class="line">            scheme: HTTP</span><br><span class="line">          initialDelaySeconds: 10</span><br><span class="line">          periodSeconds: 10</span><br><span class="line">          successThreshold: 1</span><br><span class="line">          timeoutSeconds: 5</span><br><span class="line">        terminationMessagePath: /dev/termination-log</span><br><span class="line">        terminationMessagePolicy: File</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - mountPath: /data</span><br><span class="line">          name: data</span><br><span class="line">      imagePullSecrets:</span><br><span class="line">      - name: harbor</span><br><span class="line">      restartPolicy: Always</span><br><span class="line">      schedulerName: default-scheduler</span><br><span class="line">      terminationGracePeriodSeconds: 30</span><br><span class="line">      volumes:</span><br><span class="line">      - nfs:</span><br><span class="line">          server: hdss7-200</span><br><span class="line">          path: /data/nfs-volume/minio</span><br><span class="line">        name: data</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="minio-2"><p>vi /data/k8s-yaml/minio/svc.yaml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: minio</span><br><span class="line">  namespace: spinnaker</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - port: 80</span><br><span class="line">    protocol: TCP</span><br><span class="line">    targetPort: 9000</span><br><span class="line">  selector:</span><br><span class="line">    app: minio</span><br><span class="line">  type: ClusterIP</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="minio-3"><p>vi /data/k8s-yaml/minio/ingress.yaml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">kind: Ingress</span><br><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">metadata: </span><br><span class="line">  name: minio</span><br><span class="line">  namespace: spinnaker</span><br><span class="line">spec:</span><br><span class="line">  rules:</span><br><span class="line">  - host: minio.od.com</span><br><span class="line">    http:</span><br><span class="line">      paths:</span><br><span class="line">      - path: /</span><br><span class="line">        backend: </span><br><span class="line">          serviceName: minio</span><br><span class="line">          servicePort: 80</span><br></pre></td></tr></table></figure></div></div></div>
<h2 id="解析域名"><a href="#解析域名" class="headerlink" title="解析域名"></a>解析域名</h2><p><code>HDSS7-11.host.com</code>上<br><figure class="highlight plain"><figcaption><span>/var/named/od.com.zone</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">minio 	60 IN A 10.4.7.10</span><br></pre></td></tr></table></figure></p>
<h2 id="应用资源配置清单"><a href="#应用资源配置清单" class="headerlink" title="应用资源配置清单"></a>应用资源配置清单</h2><p>任意运算节点上：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@hdss7-21 ~]# kubectl apply -f https://k8s-yaml.od.com/minio/deployment.yaml </span><br><span class="line">deployment.extensions/minio created</span><br><span class="line">[root@hdss7-21 ~]# kubectl apply -f https://k8s-yaml.od.com/minio/svc.yaml </span><br><span class="line">service/minio created</span><br><span class="line">[root@hdss7-21 ~]# kubectl apply -f https://k8s-yaml.od.com/minio/ingress.yaml </span><br><span class="line">ingress.extensions/minio created</span><br></pre></td></tr></table></figure></p>
<h2 id="浏览器访问"><a href="#浏览器访问" class="headerlink" title="浏览器访问"></a>浏览器访问</h2><p><a href="http://minio.od.com" target="_blank" rel="noopener">http://minio.od.com</a></p>
<h1 id="部署Redis"><a href="#部署Redis" class="headerlink" title="部署Redis"></a>部署Redis</h1><h2 id="准备docker镜像-1"><a href="#准备docker镜像-1" class="headerlink" title="准备docker镜像"></a>准备docker镜像</h2><p>运维主机<code>HDSS7-200.host.com</code>上：<br><a href="https://hub.docker.com/_/redis" target="_blank" rel="noopener">镜像下载地址</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@hdss7-200 ~]# docker pull redis:4.0.14</span><br><span class="line">4.0.14: Pulling from library/redis</span><br><span class="line">743f2d6c1f65: Pull complete </span><br><span class="line">171658c5966d: Pull complete </span><br><span class="line">fbef10bd7a65: Pull complete </span><br><span class="line">1111aefffd16: Pull complete </span><br><span class="line">3b9af921a085: Pull complete </span><br><span class="line">e0659698d44a: Pull complete </span><br><span class="line">Digest: sha256:2e82b9fc2c0396f6056b180743f5cf05219908b9e0c9e7046041588ebd1363d1</span><br><span class="line">Status: Downloaded newer image for redis:4.0.14</span><br><span class="line">[root@hdss7-200 ~]# docker tag 720768125f4f harbor.od.com/spinnaker/redis:v4.0.14</span><br><span class="line">[root@hdss7-200 ~]# docker push harbor.od.com/spinnaker/redis:v4.0.14</span><br><span class="line">docker push harbor.od.com/spinnaker/redis:v4.0.14</span><br><span class="line">The push refers to a repository [harbor.od.com/spinnaker/redis]</span><br><span class="line">675b01d6b533: Pushed </span><br><span class="line">a6104c28b530: Pushed </span><br><span class="line">49be6cb1f430: Pushed </span><br><span class="line">03eafa792876: Pushed </span><br><span class="line">f99f83132c0a: Pushed </span><br><span class="line">6270adb5794c: Pushed </span><br><span class="line">v4.0.14: digest: sha256:b1aaa4a4e2c0ae115c1bae57ce0f957dd9440f52fae42af9e1c2e165ea7e0aba size: 1571</span><br></pre></td></tr></table></figure></p>
<h2 id="准备资源配置清单-1"><a href="#准备资源配置清单-1" class="headerlink" title="准备资源配置清单"></a>准备资源配置清单</h2><div class="tabs" id="redis"><ul class="nav-tabs"><li class="tab active"><a href="#redis-1">Deployment</a></li><li class="tab"><a href="#redis-2">Service</a></li></ul><div class="tab-content"><div class="tab-pane active" id="redis-1"><p>vi /data/k8s-yaml/redis/deployment.yaml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">kind: Deployment</span><br><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    name: redis</span><br><span class="line">  name: redis</span><br><span class="line">  namespace: spinnaker</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  revisionHistoryLimit: 7</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      name: redis</span><br><span class="line">  strategy:</span><br><span class="line">    rollingUpdate:</span><br><span class="line">      maxSurge: 1</span><br><span class="line">      maxUnavailable: 1</span><br><span class="line">    type: RollingUpdate</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: redis</span><br><span class="line">        name: redis</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: redis</span><br><span class="line">        image: harbor.od.com/spinnaker/redis:v4.0.14</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 6379</span><br><span class="line">          protocol: TCP</span><br><span class="line">        terminationMessagePath: /dev/termination-log</span><br><span class="line">        terminationMessagePolicy: File</span><br><span class="line">      imagePullSecrets:</span><br><span class="line">      - name: harbor</span><br><span class="line">      restartPolicy: Always</span><br><span class="line">      schedulerName: default-scheduler</span><br><span class="line">      terminationGracePeriodSeconds: 30</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="redis-2"><p>vi /data/k8s-yaml/redis/svc.yaml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: redis</span><br><span class="line">  namespace: spinnaker</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - port: 6379</span><br><span class="line">    protocol: TCP</span><br><span class="line">    targetPort: 6379</span><br><span class="line">  selector:</span><br><span class="line">    app: redis</span><br><span class="line">  type: ClusterIP</span><br></pre></td></tr></table></figure></div></div></div>
<h2 id="应用资源配置清单-1"><a href="#应用资源配置清单-1" class="headerlink" title="应用资源配置清单"></a>应用资源配置清单</h2><p>任意运算节点上：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@hdss7-21 ~]# kubectl apply -f https://k8s-yaml.od.com/redis/deployment.yaml </span><br><span class="line">deployment.extensions/redis created</span><br><span class="line">[root@hdss7-21 ~]# kubectl apply -f https://k8s-yaml.od.com/redis/svc.yaml </span><br><span class="line">service/redis created</span><br></pre></td></tr></table></figure></p>
<h1 id="部署CloudDriver"><a href="#部署CloudDriver" class="headerlink" title="部署CloudDriver"></a>部署CloudDriver</h1><p>运维主机<code>HDSS7-200.host.com</code>上：</p>
<h2 id="准备docker镜像-2"><a href="#准备docker镜像-2" class="headerlink" title="准备docker镜像"></a>准备docker镜像</h2><p><a href="https://quay.io/repository/container-image/spinnaker-clouddriver" target="_blank" rel="noopener">镜像下载地址</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@hdss7-200 ~]# docker pull quay.io/container-image/spinnaker-clouddriver:4.3.0-20190128134206</span><br><span class="line">4.3.0-20190128134206: Pulling from container-image/spinnaker-clouddriver</span><br><span class="line"></span><br><span class="line">35920a071f91: Pull complete </span><br><span class="line">88b05767cad1: Pull complete </span><br><span class="line">3f8bd0101cd3: Pull complete </span><br><span class="line">1f055e83a236: Pull complete </span><br><span class="line">144fd385f584: Pull complete </span><br><span class="line">f6c8f5d7f704: Pull complete </span><br><span class="line">613069df7b32: Pull complete </span><br><span class="line">e4ae8f830423: Pull complete </span><br><span class="line">Digest: sha256:34cf9c03911fc2fc8ec728f8c3eecfe04a82705bc5d6ce70223235bf337c2fc2</span><br><span class="line">Status: Downloaded newer image for quay.io/container-image/spinnaker-clouddriver:4.3.0-20190128134206</span><br><span class="line">[root@hdss7-200 ~]# docker tag be10393ea45e harbor.od.com/spinnaker/clouddriver:v4.3.0</span><br><span class="line">[root@hdss7-200 ~]# docker push harbor.od.com/spinnaker/clouddriver:v4.3.0</span><br><span class="line">The push refers to a repository [harbor.od.com/spinnaker/clouddriver]</span><br><span class="line">060c6a71a4b8: Pushed </span><br><span class="line">fe8ea4bcebb0: Pushed </span><br><span class="line">34cab728765a: Pushed </span><br><span class="line">a7c1f802e045: Pushed </span><br><span class="line">46abf18f621c: Pushed </span><br><span class="line">7bbd7cb9c0eb: Pushed </span><br><span class="line">b845f393fc2b: Pushed </span><br><span class="line">dbc783c89851: Pushed </span><br><span class="line">7bff100f35cb: Pushed </span><br><span class="line">v4.3.0: digest: sha256:ff075168d339ada5a474d09f9b875bbd713eb3f3815b81f15a10b2a442deaa00 size: 2216</span><br></pre></td></tr></table></figure></p>
<h2 id="准备cluster-admin用户配置"><a href="#准备cluster-admin用户配置" class="headerlink" title="准备cluster-admin用户配置"></a>准备cluster-admin用户配置</h2><p>运维主机<code>HDSS7-200.host.com</code>上：</p>
<ul>
<li><p>签发admin.pem、admin-key.pem</p>
<blockquote>
<p>参考实验文档1</p>
</blockquote>
</li>
<li><p>做admin.kubeconfig</p>
</li>
</ul>
<figure class="highlight plain"><figcaption><span>/opt/certs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@hdss7-200 certs]# kubectl config set-cluster myk8s --certificate-authority=./ca.pem --embed-certs=true --server=https://10.4.7.10:7443 --kubeconfig=config</span><br><span class="line">Cluster &quot;myk8s&quot; set.</span><br><span class="line">[root@hdss7-200 certs]# kubectl config set-credentials cluster-admin --client-certificate=./admin.pem --client-key=./admin-key.pem --embed-certs=true --kubeconfig=config</span><br><span class="line">User &quot;cluster-admin&quot; set.</span><br><span class="line">[root@hdss7-200 certs]# kubectl config set-context myk8s-context --cluster=myk8s --user=cluster-admin --kubeconfig=config</span><br><span class="line">Context &quot;myk8s-context&quot; created.</span><br><span class="line">[root@hdss7-200 certs]# kubectl config use-context myk8s-context --kubeconfig=config</span><br><span class="line">Switched to context &quot;myk8s-context&quot;.</span><br><span class="line">[root@hdss7-200 certs]# kubectl create clusterrolebinding myk8s-admin --clusterrole=cluster-admin --user=cluster-admin</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/myk8s-admin created</span><br></pre></td></tr></table></figure>
<ul>
<li><p>验证</p>
<blockquote>
<p>将config文件拷贝至任意运算节点/root/.kube下，使用kubectl验证</p>
</blockquote>
</li>
<li><p>创建cm</p>
</li>
</ul>
<figure class="highlight plain"><figcaption><span>/root/.kube</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@hdss7-21 .kube]# kubectl create cm kubeconfig --from-file=config -n spinnaker</span><br></pre></td></tr></table></figure>
<h2 id="准备资源配置清单-2"><a href="#准备资源配置清单-2" class="headerlink" title="准备资源配置清单"></a>准备资源配置清单</h2><div class="tabs" id="clouddriver"><ul class="nav-tabs"><li class="tab active"><a href="#clouddriver-1">ConfigMap</a></li><li class="tab"><a href="#clouddriver-2">Deployment</a></li><li class="tab"><a href="#clouddriver-3">Service</a></li></ul><div class="tab-content"><div class="tab-pane active" id="clouddriver-1"><p>vi /data/k8s-yaml/clouddriver/cm.yaml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">kind: ConfigMap</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: clouddriver</span><br><span class="line">  namespace: spinnaker</span><br><span class="line">data:</span><br><span class="line">  clouddriver.yml: |</span><br><span class="line">    server:</span><br><span class="line">      port: 7002</span><br><span class="line">      ssl:</span><br><span class="line">        enabled: false</span><br><span class="line">    redis:</span><br><span class="line">      connection: redis://redis:6379</span><br><span class="line">      scheduler: default</span><br><span class="line">      parallelism: -1</span><br><span class="line"></span><br><span class="line">    services:</span><br><span class="line">      front50:</span><br><span class="line">        baseUrl: <a href="http://front50" target="_blank" rel="noopener">http://front50</a></span><br><span class="line"></span><br><span class="line">    management.health.elasticsearch.enabled: false</span><br><span class="line">    kubernetes:</span><br><span class="line">      enabled: true</span><br><span class="line">      accounts:</span><br><span class="line">        - name: cluster-admin</span><br><span class="line">          serviceAccount: false</span><br><span class="line">          dockerRegistries:</span><br><span class="line">            - accountName: harbor-admin</span><br><span class="line">              namespaces: []</span><br><span class="line">          namespaces:</span><br><span class="line">            - spinnaker</span><br><span class="line">            - infra</span><br><span class="line">            - app-test</span><br><span class="line">            - app-prod</span><br><span class="line">          kubeconfigFile:  /etc/kubernetes/config</span><br><span class="line">      primaryAccount: cluster-admin</span><br><span class="line">    dockerRegistry:</span><br><span class="line">      enabled: true</span><br><span class="line">      accounts:</span><br><span class="line">        - name: harbor-admin</span><br><span class="line">          requiredGroupMembership: []</span><br><span class="line">          providerVersion: V1</span><br><span class="line">          insecureRegistry: true</span><br><span class="line">          address: <a href="http://harbor.od.com" target="_blank" rel="noopener">http://harbor.od.com</a></span><br><span class="line">          username: admin</span><br><span class="line">          password: Harbor12345</span><br><span class="line">      primaryAccount: harbor-admin</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="clouddriver-2"><p>vi /data/k8s-yaml/clouddriver/deployment.yaml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app: clouddriver</span><br><span class="line">  name: clouddriver</span><br><span class="line">  namespace: spinnaker</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  revisionHistoryLimit: 7</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: clouddriver</span><br><span class="line">  strategy:</span><br><span class="line">    rollingUpdate:</span><br><span class="line">      maxSurge: 1</span><br><span class="line">      maxUnavailable: 1</span><br><span class="line">    type: RollingUpdate</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: clouddriver</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - image: harbor.od.com/spinnaker/clouddriver:v4.3.0</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        name: clouddriver</span><br><span class="line">        terminationMessagePath: /dev/termination-log</span><br><span class="line">        terminationMessagePolicy: File</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - mountPath: /etc/kubernetes</span><br><span class="line">          name: kubeconfig</span><br><span class="line">        - mountPath: /opt/clouddriver/config</span><br><span class="line">          name: clouddriver</span><br><span class="line">      imagePullSecrets:</span><br><span class="line">      - name: harbor</span><br><span class="line">      restartPolicy: Always</span><br><span class="line">      terminationGracePeriodSeconds: 30</span><br><span class="line">      volumes:</span><br><span class="line">      - configMap:</span><br><span class="line">          defaultMode: 420</span><br><span class="line">          name: kubeconfig</span><br><span class="line">        name: kubeconfig</span><br><span class="line">      - configMap:</span><br><span class="line">          defaultMode: 420</span><br><span class="line">          name: clouddriver</span><br><span class="line">        name: clouddriver</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="clouddriver-3"><p>vi /data/k8s-yaml/clouddriver/svc.yaml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: clouddriver</span><br><span class="line">  namespace: spinnaker</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - port: 80</span><br><span class="line">    protocol: TCP</span><br><span class="line">    targetPort: 7002</span><br><span class="line">  selector:</span><br><span class="line">    app: clouddriver</span><br><span class="line">  type: ClusterIP</span><br></pre></td></tr></table></figure></div></div></div>
<h2 id="应用资源配置清单-2"><a href="#应用资源配置清单-2" class="headerlink" title="应用资源配置清单"></a>应用资源配置清单</h2><p>任意一台运算节点上：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@hdss7-21 ~]# kubectl apply -f http://k8s-yaml.od.com/clouddriver/cm.yaml </span><br><span class="line">configmap/clouddriver created</span><br><span class="line">configmap/kubeconfig created</span><br><span class="line">[root@hdss7-21 ~]# kubectl apply -f http://k8s-yaml.od.com/clouddriver/deployment.yaml </span><br><span class="line">deployment.extensions/clouddriver created</span><br><span class="line">[root@hdss7-21 ~]# kubectl apply -f http://k8s-yaml.od.com/clouddriver/svc.yaml </span><br><span class="line">service/clouddriver created</span><br></pre></td></tr></table></figure></p>
<h1 id="部署Front50"><a href="#部署Front50" class="headerlink" title="部署Front50"></a>部署Front50</h1><p>运维主机<code>HDSS7-200.host.com</code>上：</p>
<h2 id="准备docker镜像-3"><a href="#准备docker镜像-3" class="headerlink" title="准备docker镜像"></a>准备docker镜像</h2><p><a href="https://quay.io/repository/container-image/spinnaker-front50" target="_blank" rel="noopener">镜像下载地址</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@hdss7-200 ~]# docker pull quay.io/container-image/spinnaker-front50:0.15.0-20190123154713</span><br><span class="line">0.15.0-20190123154713: Pulling from container-image/spinnaker-front50</span><br><span class="line"></span><br><span class="line">cd784148e348: Already exists </span><br><span class="line">1a5149a464dd: Pull complete </span><br><span class="line">26bf3384364c: Pull complete </span><br><span class="line">69dd8d165987: Pull complete </span><br><span class="line">32fe51b2b4d9: Pull complete </span><br><span class="line">Digest: sha256:c8ef16b8af2d19d600cca5e8cc23804bd2c1d5514388773a10b6066f94618a72</span><br><span class="line">Status: Downloaded newer image for quay.io/container-image/spinnaker-front50:0.15.0-20190123154713</span><br><span class="line">[root@hdss7-200 ~]# docker tag dc9a643cca87 harbor.od.com/spinnaker/front50:v0.15.0</span><br><span class="line">[root@hdss7-200 ~]# docker push harbor.od.com/spinnaker/front50:v0.15.0</span><br><span class="line">The push refers to a repository [harbor.od.com/spinnaker/front50]</span><br><span class="line">eabce1ea6140: Pushed </span><br><span class="line">90b2472b7159: Pushed </span><br><span class="line">891f51ecb4e3: Pushed </span><br><span class="line">382d47ad6dc1: Pushed </span><br><span class="line">dbc783c89851: Mounted from spinnaker/clouddriver </span><br><span class="line">7bff100f35cb: Mounted from spinnaker/clouddriver </span><br><span class="line">v0.15.0: digest: sha256:4567e45433305ebed2f66f079db3d17e62675740e9a19006fa4d33c0af492720 size: 1579</span><br></pre></td></tr></table></figure></p>
<h2 id="准备资源配置清单-3"><a href="#准备资源配置清单-3" class="headerlink" title="准备资源配置清单"></a>准备资源配置清单</h2><div class="tabs" id="front50"><ul class="nav-tabs"><li class="tab active"><a href="#front50-1">ConfigMap</a></li><li class="tab"><a href="#front50-2">Deployment</a></li><li class="tab"><a href="#front50-3">Service</a></li></ul><div class="tab-content"><div class="tab-pane active" id="front50-1"><p>vi /data/k8s-yaml/front50/cm.yaml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">kind: ConfigMap</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: front50</span><br><span class="line">  namespace: spinnaker</span><br><span class="line">data:</span><br><span class="line">  credentials: |</span><br><span class="line">    [default]</span><br><span class="line">    aws_access_key_id=admin</span><br><span class="line">    aws_secret_access_key=poiuytrewq</span><br><span class="line">  front50.yml: |</span><br><span class="line">    server:</span><br><span class="line">      port: 8080</span><br><span class="line"></span><br><span class="line">    management:</span><br><span class="line">      health:</span><br><span class="line">        redis:</span><br><span class="line">          enabled: false</span><br><span class="line"></span><br><span class="line">    cassandra:</span><br><span class="line">      enabled: false</span><br><span class="line"></span><br><span class="line">    spinnaker:</span><br><span class="line">      cassandra:</span><br><span class="line">        enabled: false</span><br><span class="line">      redis:</span><br><span class="line">        enabled: false</span><br><span class="line">      s3:</span><br><span class="line">        endpoint: <a href="http://minio" target="_blank" rel="noopener">http://minio</a></span><br><span class="line">        enabled: true</span><br><span class="line">        bucket: spinnaker</span><br><span class="line">      rootFolder: front50</span><br><span class="line">    swagger:</span><br><span class="line">      enabled: true</span><br><span class="line">      title: Spinnaker Front50 API</span><br><span class="line">      description:</span><br><span class="line">      contact:</span><br><span class="line">      patterns:</span><br><span class="line">        - /default/.<em></em></span><br><span class="line">        - /credentials.</span><br><span class="line">        - /global/.<em></em></span><br><span class="line">        - /notifications.</span><br><span class="line">        - /pipelines.<em></em></span><br><span class="line">        - /strategies.</span><br><span class="line">        - /v2/.*</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="front50-2"><p>vi /data/k8s-yaml/front50/deployment.yaml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app: front50</span><br><span class="line">  name: front50</span><br><span class="line">  namespace: spinnaker</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  revisionHistoryLimit: 7</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: front50</span><br><span class="line">  strategy:</span><br><span class="line">    rollingUpdate:</span><br><span class="line">      maxSurge: 1</span><br><span class="line">      maxUnavailable: 1</span><br><span class="line">    type: RollingUpdate</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: front50</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - image: harbor.od.com/spinnaker/front50:v0.15.0</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        name: front50</span><br><span class="line">        terminationMessagePath: /dev/termination-log</span><br><span class="line">        terminationMessagePolicy: File</span><br><span class="line">        securityContext: </span><br><span class="line">          runAsUser: 0</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - mountPath: /opt/front50/config</span><br><span class="line">          name: front</span><br><span class="line">        - mountPath: /root/.aws</span><br><span class="line">          name: aws</span><br><span class="line">      imagePullSecrets:</span><br><span class="line">      - name: harbor</span><br><span class="line">      restartPolicy: Always</span><br><span class="line">      terminationGracePeriodSeconds: 30</span><br><span class="line">      volumes:</span><br><span class="line">      - configMap:</span><br><span class="line">          defaultMode: 420</span><br><span class="line">          items:</span><br><span class="line">          - key: front50.yml</span><br><span class="line">            path: front50.yml</span><br><span class="line">          name: front50</span><br><span class="line">        name: front</span><br><span class="line">      - configMap:</span><br><span class="line">          defaultMode: 420</span><br><span class="line">          items:</span><br><span class="line">          - key: credentials</span><br><span class="line">            path: credentials</span><br><span class="line">          name: front50</span><br><span class="line">        name: aws</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="front50-3"><p>vi /data/k8s-yaml/front50/svc.yaml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: front50</span><br><span class="line">  namespace: spinnaker</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - port: 80</span><br><span class="line">    protocol: TCP</span><br><span class="line">    targetPort: 8080</span><br><span class="line">  selector:</span><br><span class="line">    app: front50</span><br><span class="line">  type: ClusterIP</span><br></pre></td></tr></table></figure></div></div></div>
<h2 id="应用资源配置清单-3"><a href="#应用资源配置清单-3" class="headerlink" title="应用资源配置清单"></a>应用资源配置清单</h2><p>任意一台运算节点上：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@hdss7-21 ~]# kubectl apply -f http://k8s-yaml.od.com/front50/cm.yaml </span><br><span class="line">configmap/front50 created</span><br><span class="line">[root@hdss7-21 ~]# kubectl apply -f http://k8s-yaml.od.com/front50/deployment.yaml </span><br><span class="line">deployment.extensions/front50 created</span><br><span class="line">[root@hdss7-21 ~]# kubectl apply -f http://k8s-yaml.od.com/front50/svc.yaml </span><br><span class="line">service/front50 created</span><br></pre></td></tr></table></figure></p>
<h2 id="浏览器访问-1"><a href="#浏览器访问-1" class="headerlink" title="浏览器访问"></a>浏览器访问</h2><p><a href="http://minio.od.com" target="_blank" rel="noopener">http://minio.od.com</a><br>登录并观察存储是否创建</p>
<h1 id="部署Orca"><a href="#部署Orca" class="headerlink" title="部署Orca"></a>部署Orca</h1><p>运维主机<code>HDSS7-200.host.com</code>上：</p>
<h2 id="准备docker镜像-4"><a href="#准备docker镜像-4" class="headerlink" title="准备docker镜像"></a>准备docker镜像</h2><p><a href="https://quay.io/repository/container-image/spinnaker-orca" target="_blank" rel="noopener">镜像下载地址</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@hdss7-200 ~]# docker pull quay.io/container-image/spinnaker-orca:2.3.0-20190128134206</span><br><span class="line">2.3.0-20190128134206: Pulling from container-image/spinnaker-orca</span><br><span class="line"></span><br><span class="line">cd784148e348: Already exists </span><br><span class="line">35920a071f91: Already exists </span><br><span class="line">42e1846e4485: Pull complete </span><br><span class="line">bc6a60341cf7: Pull complete </span><br><span class="line">19c9805c6a8e: Pull complete </span><br><span class="line">Digest: sha256:c5994af4100caa9d55ec81aebbd0ca8121520ca48c29daa43757ae3750db2f48</span><br><span class="line">Status: Downloaded newer image for quay.io/container-image/spinnaker-orca:2.3.0-20190128134206</span><br><span class="line">[root@hdss7-200 ~]# docker tag 619c3af0b837 harbor.od.com/spinnaker/orca:v2.3.0</span><br><span class="line">[root@hdss7-200 ~]# docker push harbor.od.com/spinnaker/orca:v2.3.0</span><br><span class="line">The push refers to a repository [harbor.od.com/spinnaker/orca]</span><br><span class="line">3af99de9eeaf: Pushed </span><br><span class="line">70d500537a7c: Pushed </span><br><span class="line">39aba6e22a54: Pushed </span><br><span class="line">382d47ad6dc1: Mounted from spinnaker/front50 </span><br><span class="line">dbc783c89851: Mounted from spinnaker/front50 </span><br><span class="line">7bff100f35cb: Mounted from spinnaker/front50 </span><br><span class="line">v2.3.0: digest: sha256:5d4109a424dd79048ea7b58a6dd42b5a5678b9a6a7299eb1783794ba597a8e83 size: 1578</span><br></pre></td></tr></table></figure></p>
<h2 id="准备资源配置清单-4"><a href="#准备资源配置清单-4" class="headerlink" title="准备资源配置清单"></a>准备资源配置清单</h2><div class="tabs" id="orca"><ul class="nav-tabs"><li class="tab active"><a href="#orca-1">ConfigMap</a></li><li class="tab"><a href="#orca-2">Deployment</a></li><li class="tab"><a href="#orca-3">Service</a></li></ul><div class="tab-content"><div class="tab-pane active" id="orca-1"><p>vi /data/k8s-yaml/orca/cm.yaml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">kind: ConfigMap</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: orca</span><br><span class="line">  namespace: spinnaker</span><br><span class="line">data:</span><br><span class="line">  orca.yml: |</span><br><span class="line">    server:</span><br><span class="line">      port: 8083</span><br><span class="line"></span><br><span class="line">    default:</span><br><span class="line">      bake:</span><br><span class="line">        account: default</span><br><span class="line"></span><br><span class="line">    front50:</span><br><span class="line">      enabled: true</span><br><span class="line">      baseUrl: <a href="http://front50" target="_blank" rel="noopener">http://front50</a></span><br><span class="line">    tide:</span><br><span class="line">      enabled: false</span><br><span class="line">    oort:</span><br><span class="line">      baseUrl: <a href="http://clouddriver" target="_blank" rel="noopener">http://clouddriver</a></span><br><span class="line">    mort:</span><br><span class="line">      baseUrl: <a href="http://clouddriver" target="_blank" rel="noopener">http://clouddriver</a></span><br><span class="line">    kato:</span><br><span class="line">      baseUrl: <a href="http://clouddriver" target="_blank" rel="noopener">http://clouddriver</a></span><br><span class="line">    echo:</span><br><span class="line">      enabled: true</span><br><span class="line">      baseUrl: <a href="http://echo" target="_blank" rel="noopener">http://echo</a></span><br><span class="line">    igor:</span><br><span class="line">      enabled: true</span><br><span class="line">      baseUrl: <a href="http://igor" target="_blank" rel="noopener">http://igor</a></span><br><span class="line">    bakery:</span><br><span class="line">      enabled: false</span><br><span class="line">      # Rosco exposes more endpoints than Netflix&apos;s internal bakery. This disables</span><br><span class="line">      # the use of those endpoints.</span><br><span class="line">      roscoApisEnabled: true</span><br><span class="line">      allowMissingPackageInstallation: false</span><br><span class="line"></span><br><span class="line">    redis:</span><br><span class="line">      connection: redis://redis:6379</span><br><span class="line"></span><br><span class="line">    keiko:</span><br><span class="line">      queue:</span><br><span class="line">        redis:</span><br><span class="line">          queueName: orca.task.queue</span><br><span class="line">          deadLetterQueueName: orca.task.deadLetterQueue</span><br><span class="line"></span><br><span class="line">    tasks:</span><br><span class="line">      useWaitForAllNetflixAWSInstancesDownTask: false</span><br><span class="line"></span><br><span class="line">    logging:</span><br><span class="line">      config: classpath:logback-defaults.xml</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="orca-2"><p>vi /data/k8s-yaml/orca/deployment.yaml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app: orca</span><br><span class="line">  name: orca</span><br><span class="line">  namespace: spinnaker</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  revisionHistoryLimit: 7</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: orca</span><br><span class="line">  strategy:</span><br><span class="line">    rollingUpdate:</span><br><span class="line">      maxSurge: 1</span><br><span class="line">      maxUnavailable: 1</span><br><span class="line">    type: RollingUpdate</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: orca</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - image: harbor.od.com/spinnaker/orca:v2.3.0</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        name: orca</span><br><span class="line">        terminationMessagePath: /dev/termination-log</span><br><span class="line">        terminationMessagePolicy: File</span><br><span class="line">        securityContext: </span><br><span class="line">          runAsUser: 0</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - mountPath: /opt/orca/config</span><br><span class="line">          name: orca</span><br><span class="line">      imagePullSecrets:</span><br><span class="line">      - name: harbor</span><br><span class="line">      restartPolicy: Always</span><br><span class="line">      terminationGracePeriodSeconds: 30</span><br><span class="line">      volumes:</span><br><span class="line">      - configMap:</span><br><span class="line">          defaultMode: 420</span><br><span class="line">          name: orca</span><br><span class="line">        name: orca</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="orca-3"><p>vi /data/k8s-yaml/orca/svc.yaml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: orca</span><br><span class="line">  namespace: spinnaker</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - port: 80</span><br><span class="line">    protocol: TCP</span><br><span class="line">    targetPort: 8083</span><br><span class="line">  selector:</span><br><span class="line">    app: orca</span><br><span class="line">  type: ClusterIP</span><br></pre></td></tr></table></figure></div></div></div>
<h2 id="应用资源配置清单-4"><a href="#应用资源配置清单-4" class="headerlink" title="应用资源配置清单"></a>应用资源配置清单</h2><p>任意一台运算节点上：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@hdss7-21 ~]# kubectl apply -f http://k8s-yaml.od.com/orca/cm.yaml </span><br><span class="line">configmap/orca created</span><br><span class="line">[root@hdss7-21 ~]# kubectl apply -f http://k8s-yaml.od.com/orca/deployment.yaml </span><br><span class="line">deployment.extensions/orca created</span><br><span class="line">[root@hdss7-21 ~]# kubectl apply -f http://k8s-yaml.od.com/orca/svc.yaml </span><br><span class="line">service/orca created</span><br></pre></td></tr></table></figure></p>
<h1 id="部署Echo"><a href="#部署Echo" class="headerlink" title="部署Echo"></a>部署Echo</h1><p>运维主机<code>HDSS7-200.host.com</code>上：</p>
<h2 id="准备docker镜像-5"><a href="#准备docker镜像-5" class="headerlink" title="准备docker镜像"></a>准备docker镜像</h2><p><a href="https://quay.io/repository/container-image/spinnaker-echo" target="_blank" rel="noopener">镜像下载地址</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@hdss7-200 ~]# docker pull quay.io/container-image/spinnaker-echo:2.3.0-20190123200115</span><br><span class="line">2.3.0-20190123200115: Pulling from container-image/spinnaker-echo</span><br><span class="line">ab1fc7e4bf91: Pull complete </span><br><span class="line">35fba333ff52: Pull complete </span><br><span class="line">f0cb1fa13079: Pull complete </span><br><span class="line">3d1dd648b5ad: Pull complete </span><br><span class="line">a9f886e483d6: Pull complete </span><br><span class="line">4346341d3c49: Pull complete </span><br><span class="line">006f2208d67a: Pull complete </span><br><span class="line">fb85cf26717d: Pull complete </span><br><span class="line">845bb5ae3b56: Pull complete </span><br><span class="line">5d242638cdfc: Pull complete </span><br><span class="line">90f2c113bf33: Pull complete </span><br><span class="line">Digest: sha256:2829f5d27e80177aed357d0159daf308fe380c3fad883c4531d580b37617ad43</span><br><span class="line">Status: Downloaded newer image for quay.io/container-image/spinnaker-echo:2.3.0-20190123200115</span><br><span class="line">[root@hdss7-200 ~]# docker tag e56354dc5c3b harbor.od.com/spinnaker/echo:v2.3.0</span><br><span class="line">[root@hdss7-200 ~]# docker push harbor.od.com/spinnaker/echo:v2.3.0</span><br><span class="line">The push refers to a repository [harbor.od.com/spinnaker/echo]</span><br><span class="line">8752d9b1121d: Pushed </span><br><span class="line">6c6ced81271d: Pushed </span><br><span class="line">eb72703b9af7: Pushed </span><br><span class="line">5144cdc9e024: Pushed </span><br><span class="line">31c8272db455: Pushed </span><br><span class="line">8e1025180705: Pushed </span><br><span class="line">0715026f2ff1: Pushed </span><br><span class="line">a89464ad2a8f: Pushed </span><br><span class="line">76dfa41f0a1d: Pushed </span><br><span class="line">c240c542ed55: Pushed </span><br><span class="line">badfbcebf7f8: Pushed </span><br><span class="line">v2.3.0: digest: sha256:fae7162a35d18b12692ad36c5dfa3e53691e8bca260d47c179c7c562b886441a size: 2634</span><br></pre></td></tr></table></figure></p>
<h2 id="准备资源配置清单-5"><a href="#准备资源配置清单-5" class="headerlink" title="准备资源配置清单"></a>准备资源配置清单</h2><div class="tabs" id="echo"><ul class="nav-tabs"><li class="tab active"><a href="#echo-1">ConfigMap</a></li><li class="tab"><a href="#echo-2">Deployment</a></li><li class="tab"><a href="#echo-3">Service</a></li></ul><div class="tab-content"><div class="tab-pane active" id="echo-1"><p>vi /data/k8s-yaml/echo/cm.yaml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">kind: ConfigMap</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: echo</span><br><span class="line">  namespace: spinnaker</span><br><span class="line">data:</span><br><span class="line">  echo.yml: |</span><br><span class="line">    server:</span><br><span class="line">      port: 8089</span><br><span class="line"></span><br><span class="line">    cassandra:</span><br><span class="line">      enabled: false</span><br><span class="line"></span><br><span class="line">    spinnaker:</span><br><span class="line">      baseUrl: <a href="http://deck" target="_blank" rel="noopener">http://deck</a></span><br><span class="line">      cassandra:</span><br><span class="line">        enabled: false</span><br><span class="line">      inMemory:</span><br><span class="line">        enabled: true</span><br><span class="line"></span><br><span class="line">    front50:</span><br><span class="line">      baseUrl: <a href="http://front50" target="_blank" rel="noopener">http://front50</a></span><br><span class="line"></span><br><span class="line">    orca:</span><br><span class="line">      baseUrl: <a href="http://orca" target="_blank" rel="noopener">http://orca</a></span><br><span class="line"></span><br><span class="line">    endpoints.health.sensitive: false</span><br><span class="line"></span><br><span class="line">    slack:</span><br><span class="line">      enabled: false</span><br><span class="line"></span><br><span class="line">    spring:</span><br><span class="line">      mail:</span><br><span class="line">        host: hdss7-200.host.com</span><br><span class="line"></span><br><span class="line">    mail:</span><br><span class="line">      enabled: true</span><br><span class="line">      host: hdss7-200.host.com</span><br><span class="line">      from: <a href="mailto:ws2319@163.com" target="_blank" rel="noopener">ws2319@163.com</a></span><br><span class="line"></span><br><span class="line">    hipchat:</span><br><span class="line">      enabled: false</span><br><span class="line"></span><br><span class="line">    twilio:</span><br><span class="line">      enabled: false</span><br><span class="line"></span><br><span class="line">    scheduler:</span><br><span class="line">      enabled: true</span><br><span class="line">      threadPoolSize: 20</span><br><span class="line">      triggeringEnabled: true</span><br><span class="line">      pipelineConfigsPoller:</span><br><span class="line">        enabled: true</span><br><span class="line">        pollingIntervalMs: 30000</span><br><span class="line">      cron:</span><br><span class="line">        timezone: Asia/Shanghai</span><br><span class="line"></span><br><span class="line">    redis:</span><br><span class="line">      connection: redis://redis:6379</span><br><span class="line"></span><br><span class="line">    webhooks:</span><br><span class="line">      artifacts:</span><br><span class="line">        enabled: true</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="echo-2"><p>vi /data/k8s-yaml/echo/deployment.yaml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app: echo</span><br><span class="line">  name: echo</span><br><span class="line">  namespace: spinnaker</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  revisionHistoryLimit: 7</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: echo</span><br><span class="line">  strategy:</span><br><span class="line">    rollingUpdate:</span><br><span class="line">      maxSurge: 1</span><br><span class="line">      maxUnavailable: 1</span><br><span class="line">    type: RollingUpdate</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: echo</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - image: harbor.od.com/spinnaker/echo:v2.3.0</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        name: echo</span><br><span class="line">        terminationMessagePath: /dev/termination-log</span><br><span class="line">        terminationMessagePolicy: File</span><br><span class="line">        securityContext: </span><br><span class="line">          runAsUser: 0</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - mountPath: /opt/echo/config</span><br><span class="line">          name: echo</span><br><span class="line">      imagePullSecrets:</span><br><span class="line">      - name: harbor</span><br><span class="line">      restartPolicy: Always</span><br><span class="line">      terminationGracePeriodSeconds: 30</span><br><span class="line">      volumes:</span><br><span class="line">      - configMap:</span><br><span class="line">          defaultMode: 420</span><br><span class="line">          name: echo</span><br><span class="line">        name: echo</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="echo-3"><p>vi /data/k8s-yaml/echo/svc.yaml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: echo</span><br><span class="line">  namespace: spinnaker</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - port: 80</span><br><span class="line">    protocol: TCP</span><br><span class="line">    targetPort: 8089</span><br><span class="line">  selector:</span><br><span class="line">    app: echo</span><br><span class="line">  type: ClusterIP</span><br></pre></td></tr></table></figure></div></div></div>
<h2 id="应用资源配置清单-5"><a href="#应用资源配置清单-5" class="headerlink" title="应用资源配置清单"></a>应用资源配置清单</h2><p>任意一台运算节点上：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@hdss7-21 ~]# kubectl apply -f http://k8s-yaml.od.com/echo/cm.yaml </span><br><span class="line">configmap/echo created</span><br><span class="line">[root@hdss7-21 ~]# kubectl apply -f http://k8s-yaml.od.com/echo/deployment.yaml </span><br><span class="line">deployment.extensions/echo created</span><br><span class="line">[root@hdss7-21 ~]# kubectl apply -f http://k8s-yaml.od.com/echo/svc.yaml </span><br><span class="line">service/echo created</span><br></pre></td></tr></table></figure></p>
<h1 id="部署Igor"><a href="#部署Igor" class="headerlink" title="部署Igor"></a>部署Igor</h1><p>运维主机<code>HDSS7-200.host.com</code>上：</p>
<h2 id="准备docker镜像-6"><a href="#准备docker镜像-6" class="headerlink" title="准备docker镜像"></a>准备docker镜像</h2><p><a href="https://quay.io/repository/container-image/spinnaker-igor" target="_blank" rel="noopener">镜像下载地址</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@hdss7-200 ~]# docker pull quay.io/container-image/spinnaker-igor:1.1.0-20190123154713</span><br><span class="line">1.1.0-20190123154713: Pulling from container-image/spinnaker-igor</span><br><span class="line"></span><br><span class="line">cd784148e348: Already exists </span><br><span class="line">35920a071f91: Already exists </span><br><span class="line">3a14a57f2792: Pull complete </span><br><span class="line">3f7df0dd19ae: Pull complete </span><br><span class="line">e340dbc6f4bf: Pull complete </span><br><span class="line">Digest: sha256:e653d7085be245bf6dded93fe41bf2c757a8413ba03ccae6959d667a78e5061b</span><br><span class="line">Status: Downloaded newer image for quay.io/container-image/spinnaker-igor:1.1.0-20190123154713</span><br><span class="line">[root@hdss7-200 ~]# docker tag 719a43aa8718 harbor.od.com/spinnaker/igor:v1.1.0</span><br><span class="line">[root@hdss7-200 ~]# docker push harbor.od.com/spinnaker/igor:v1.1.0</span><br><span class="line">The push refers to a repository [harbor.od.com/spinnaker/igor]</span><br><span class="line">5355896bc30a: Pushed </span><br><span class="line">7024e25c1a5a: Pushed </span><br><span class="line">faaa6bf89d9e: Pushed </span><br><span class="line">382d47ad6dc1: Mounted from spinnaker/orca </span><br><span class="line">dbc783c89851: Mounted from spinnaker/orca </span><br><span class="line">7bff100f35cb: Mounted from spinnaker/orca </span><br><span class="line">v1.1.0: digest: sha256:997843cf6f26c6f3e647cca882b0393297dba41dc2a70b3f86acdaee337c5c33 size: 1578</span><br></pre></td></tr></table></figure></p>
<h2 id="准备资源配置清单-6"><a href="#准备资源配置清单-6" class="headerlink" title="准备资源配置清单"></a>准备资源配置清单</h2><div class="tabs" id="igor"><ul class="nav-tabs"><li class="tab active"><a href="#igor-1">ConfigMap</a></li><li class="tab"><a href="#igor-2">Deployment</a></li><li class="tab"><a href="#igor-3">Service</a></li></ul><div class="tab-content"><div class="tab-pane active" id="igor-1"><p>vi /data/k8s-yaml/igor/cm.yaml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">kind: ConfigMap</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: igor</span><br><span class="line">  namespace: spinnaker</span><br><span class="line">data:</span><br><span class="line">  igor.yml: |</span><br><span class="line">    server:</span><br><span class="line">      port: 8088</span><br><span class="line"></span><br><span class="line">    redis:</span><br><span class="line">      connection: redis://redis:6379</span><br><span class="line">      </span><br><span class="line">    jenkins:</span><br><span class="line">      enabled: true</span><br><span class="line">      masters:</span><br><span class="line">        -</span><br><span class="line">          address: <a href="http://jenkins.infra" target="_blank" rel="noopener">http://jenkins.infra</a></span><br><span class="line">          name: jenkins</span><br><span class="line">          password: admin123</span><br><span class="line">          username: admin</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="igor-2"><p>vi /data/k8s-yaml/igor/deployment.yaml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app: igor</span><br><span class="line">  name: igor</span><br><span class="line">  namespace: spinnaker</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  revisionHistoryLimit: 7</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: igor</span><br><span class="line">  strategy:</span><br><span class="line">    rollingUpdate:</span><br><span class="line">      maxSurge: 1</span><br><span class="line">      maxUnavailable: 1</span><br><span class="line">    type: RollingUpdate</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: igor</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - image: harbor.od.com/spinnaker/igor:v1.1.0</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        name: igor</span><br><span class="line">        terminationMessagePath: /dev/termination-log</span><br><span class="line">        terminationMessagePolicy: File</span><br><span class="line">        securityContext: </span><br><span class="line">          runAsUser: 0</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - mountPath: /opt/igor/config</span><br><span class="line">          name: igor</span><br><span class="line">      imagePullSecrets:</span><br><span class="line">      - name: harbor</span><br><span class="line">      restartPolicy: Always</span><br><span class="line">      terminationGracePeriodSeconds: 30</span><br><span class="line">      volumes:</span><br><span class="line">      - configMap:</span><br><span class="line">          defaultMode: 420</span><br><span class="line">          name: igor</span><br><span class="line">        name: igor</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="igor-3"><p>vi /data/k8s-yaml/igor/svc.yaml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: igor</span><br><span class="line">  namespace: spinnaker</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - port: 80</span><br><span class="line">    protocol: TCP</span><br><span class="line">    targetPort: 8088</span><br><span class="line">  selector:</span><br><span class="line">    app: igor</span><br><span class="line">  type: ClusterIP</span><br></pre></td></tr></table></figure></div></div></div>
<h2 id="应用资源配置清单-6"><a href="#应用资源配置清单-6" class="headerlink" title="应用资源配置清单"></a>应用资源配置清单</h2><p>任意一台运算节点上：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@hdss7-21 ~]# kubectl apply -f http://k8s-yaml.od.com/igor/cm.yaml </span><br><span class="line">configmap/igor created</span><br><span class="line">[root@hdss7-21 ~]# kubectl apply -f http://k8s-yaml.od.com/igor/deployment.yaml </span><br><span class="line">deployment.extensions/igor created</span><br><span class="line">[root@hdss7-21 ~]# kubectl apply -f http://k8s-yaml.od.com/igor/svc.yaml </span><br><span class="line">service/igor created</span><br></pre></td></tr></table></figure></p>
<h1 id="部署Gate"><a href="#部署Gate" class="headerlink" title="部署Gate"></a>部署Gate</h1><p>运维主机<code>HDSS7-200.host.com</code>上：</p>
<h2 id="准备docker镜像-7"><a href="#准备docker镜像-7" class="headerlink" title="准备docker镜像"></a>准备docker镜像</h2><p><a href="https://quay.io/repository/container-image/spinnaker-gate" target="_blank" rel="noopener">镜像下载地址</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@hdss7-200 ~]# docker pull quay.io/container-image/spinnaker-gate:1.5.0-20190123154713</span><br><span class="line">1.5.0-20190123154713: Pulling from container-image/spinnaker-gate</span><br><span class="line"></span><br><span class="line">cd784148e348: Already exists </span><br><span class="line">35920a071f91: Already exists </span><br><span class="line">5abffd2fef8e: Pull complete </span><br><span class="line">eaebfee37cc8: Pull complete </span><br><span class="line">d29593b154a0: Pull complete </span><br><span class="line">Digest: sha256:7d46cebaf06c5496cec03fddab43646a9a4b1d42ecd8e32fc8b2ca1ed1e2fb2f</span><br><span class="line">Status: Downloaded newer image for quay.io/container-image/spinnaker-gate:1.5.0-20190123154713</span><br><span class="line">[root@hdss7-200 ~]# docker tag 15edc59823a3 harbor.od.com/spinnaker/gate:v1.5.0</span><br><span class="line">[root@hdss7-200 ~]# docker push harbor.od.com/spinnaker/gate:v1.5.0</span><br><span class="line">The push refers to a repository [harbor.od.com/spinnaker/gate]</span><br><span class="line">0f729725e45a: Pushed </span><br><span class="line">cfbf10ed46bf: Pushed </span><br><span class="line">6c65665dab4c: Pushed </span><br><span class="line">382d47ad6dc1: Mounted from spinnaker/igor </span><br><span class="line">dbc783c89851: Mounted from spinnaker/igor </span><br><span class="line">7bff100f35cb: Mounted from spinnaker/igor </span><br><span class="line">v1.5.0: digest: sha256:0ed100d855506a1df7fa97bd8cb0ae77266cca556d0a8f5f877427089eb6be23 size: 1578</span><br></pre></td></tr></table></figure></p>
<h2 id="准备资源配置清单-7"><a href="#准备资源配置清单-7" class="headerlink" title="准备资源配置清单"></a>准备资源配置清单</h2><div class="tabs" id="gate"><ul class="nav-tabs"><li class="tab active"><a href="#gate-1">ConfigMap</a></li><li class="tab"><a href="#gate-2">Deployment</a></li><li class="tab"><a href="#gate-3">Service</a></li><li class="tab"><a href="#gate-4">Ingress</a></li></ul><div class="tab-content"><div class="tab-pane active" id="gate-1"><p>vi /data/k8s-yaml/gate/cm.yaml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">kind: ConfigMap</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: gate</span><br><span class="line">  namespace: spinnaker</span><br><span class="line">data:</span><br><span class="line">  gate.yml: |</span><br><span class="line">    server:</span><br><span class="line">      port: 8084</span><br><span class="line"></span><br><span class="line">    services:</span><br><span class="line">      deck:</span><br><span class="line">        baseUrl: <a href="http://deck" target="_blank" rel="noopener">http://deck</a></span><br><span class="line">      orca:</span><br><span class="line">        baseUrl: <a href="http://orca" target="_blank" rel="noopener">http://orca</a></span><br><span class="line">      front50:</span><br><span class="line">        canaryConfigStore: false</span><br><span class="line">        baseUrl: <a href="http://front50" target="_blank" rel="noopener">http://front50</a></span><br><span class="line">      clouddriver:</span><br><span class="line">        baseUrl: <a href="http://clouddriver" target="_blank" rel="noopener">http://clouddriver</a></span><br><span class="line">      rosco:</span><br><span class="line">        enabled: false</span><br><span class="line">    # optional services:</span><br><span class="line">      echo:</span><br><span class="line">        enabled: false</span><br><span class="line">      fiat:</span><br><span class="line">        enabled: false</span><br><span class="line">      flapjack:</span><br><span class="line">        enabled: false</span><br><span class="line">      igor:</span><br><span class="line">        enabled: false</span><br><span class="line">      mahe:</span><br><span class="line">        enabled: false</span><br><span class="line">      kayenta:</span><br><span class="line">        enabled: false</span><br><span class="line">        canaryConfigStore: false</span><br><span class="line"></span><br><span class="line">    redis:</span><br><span class="line">      connection: redis://redis:6379</span><br><span class="line">    ldap:</span><br><span class="line">      enabled: false</span><br><span class="line">    swagger:</span><br><span class="line">      enabled: true</span><br><span class="line">      title: Spinnaker API</span><br><span class="line">      description:</span><br><span class="line">      contact:</span><br><span class="line">      patterns:</span><br><span class="line">        - .<em>tasks.</em></span><br><span class="line">        - .<em>auth.</em></span><br><span class="line">        - .<em>applications.</em></span><br><span class="line">        - .<em>securityGroups.</em></span><br><span class="line">        - /search</span><br><span class="line">        - .<em>pipelines.</em></span><br><span class="line">        - .<em>loadBalancers.</em></span><br><span class="line">        - .<em>instances.</em></span><br><span class="line">        - .<em>images.</em></span><br><span class="line">        - .<em>elasticIps.</em></span><br><span class="line">        - .<em>credentials.</em></span><br><span class="line">        - .<em>events.</em></span><br><span class="line">        - .<em>builds.</em></span><br><span class="line">        - .<em>instanceTypes.</em></span><br><span class="line">        - .<em>vpcs.</em></span><br><span class="line">        - .<em>subnets.</em></span><br><span class="line">        - .<em>networks.</em></span><br><span class="line">        - .<em>bakery.</em></span><br><span class="line">        - .<em>executions.</em></span><br><span class="line">        - .<em>webhooks.</em></span><br><span class="line">        - /v2/.*</span><br><span class="line">    hystrix:</span><br><span class="line">      command:</span><br><span class="line">    ## Hystrix Global Defaults</span><br><span class="line">        default:</span><br><span class="line">          execution.isolation.thread.timeoutInMilliseconds: 60000</span><br><span class="line">    ## Command-specific overrides</span><br><span class="line">        fetchGlobalAccounts:</span><br><span class="line">          execution.isolation.thread.timeoutInMilliseconds: 2000</span><br><span class="line">    spring:</span><br><span class="line">      jackson:</span><br><span class="line">        mapper:</span><br><span class="line">          SORT_PROPERTIES_ALPHABETICALLY: true</span><br><span class="line">        serialization:</span><br><span class="line">          ORDER_MAP_ENTRIES_BY_KEYS: true</span><br><span class="line">    spring.session.store-type: redis</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="gate-2"><p>vi /data/k8s-yaml/gate/deployment.yaml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app: gate</span><br><span class="line">  name: gate</span><br><span class="line">  namespace: spinnaker</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  revisionHistoryLimit: 7</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: gate</span><br><span class="line">  strategy:</span><br><span class="line">    rollingUpdate:</span><br><span class="line">      maxSurge: 1</span><br><span class="line">      maxUnavailable: 1</span><br><span class="line">    type: RollingUpdate</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: gate</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - image: harbor.od.com/spinnaker/gate:v1.5.0</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        name: gate</span><br><span class="line">        terminationMessagePath: /dev/termination-log</span><br><span class="line">        terminationMessagePolicy: File</span><br><span class="line">        securityContext: </span><br><span class="line">          runAsUser: 0</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - mountPath: /opt/gate/config</span><br><span class="line">          name: gate</span><br><span class="line">      imagePullSecrets:</span><br><span class="line">      - name: harbor</span><br><span class="line">      restartPolicy: Always</span><br><span class="line">      terminationGracePeriodSeconds: 30</span><br><span class="line">      volumes:</span><br><span class="line">      - configMap:</span><br><span class="line">          defaultMode: 420</span><br><span class="line">          name: gate</span><br><span class="line">        name: gate</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="gate-3"><p>vi /data/k8s-yaml/gate/svc.yaml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: gate</span><br><span class="line">  namespace: spinnaker</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - port: 80</span><br><span class="line">    protocol: TCP</span><br><span class="line">    targetPort: 8084</span><br><span class="line">  selector:</span><br><span class="line">    app: gate</span><br><span class="line">  type: ClusterIP</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="gate-4"><p>vi /data/k8s-yaml/gate/ingress.yaml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">kind: Ingress</span><br><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">metadata: </span><br><span class="line">  name: deck</span><br><span class="line">  namespace: spinnaker</span><br><span class="line">spec:</span><br><span class="line">  rules:</span><br><span class="line">  - host: gate.od.com</span><br><span class="line">    http:</span><br><span class="line">      paths:</span><br><span class="line">      - path: /</span><br><span class="line">        backend: </span><br><span class="line">          serviceName: gate</span><br><span class="line">          servicePort: 80</span><br></pre></td></tr></table></figure></div></div></div>
<h2 id="应用资源配置清单-7"><a href="#应用资源配置清单-7" class="headerlink" title="应用资源配置清单"></a>应用资源配置清单</h2><p>任意一台运算节点上：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@hdss7-21 ~]# kubectl apply -f http://k8s-yaml.od.com/gate/cm.yaml </span><br><span class="line">configmap/gate created</span><br><span class="line">[root@hdss7-21 ~]# kubectl apply -f http://k8s-yaml.od.com/gate/deployment.yaml </span><br><span class="line">deployment.extensions/gate created</span><br><span class="line">[root@hdss7-21 ~]# kubectl apply -f http://k8s-yaml.od.com/gate/svc.yaml </span><br><span class="line">service/gate created</span><br></pre></td></tr></table></figure></p>
<h1 id="部署Deck"><a href="#部署Deck" class="headerlink" title="部署Deck"></a>部署Deck</h1><p>运维主机<code>HDSS7-200.host.com</code>上：</p>
<h2 id="准备docker镜像-8"><a href="#准备docker镜像-8" class="headerlink" title="准备docker镜像"></a>准备docker镜像</h2><p><a href="https://quay.io/repository/container-image/spinnaker-deck" target="_blank" rel="noopener">镜像下载地址</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@hdss7-200 ~]# docker pull quay.io/container-image/spinnaker-deck:2.7.0-20190123200115</span><br><span class="line">2.7.0-20190123200115: Pulling from container-image/spinnaker-deck</span><br><span class="line">a4aa50fa9594: Pull complete </span><br><span class="line">209b18efd318: Pull complete </span><br><span class="line">26cdadfbf7fc: Pull complete </span><br><span class="line">9ce01d906dbd: Pull complete </span><br><span class="line">9c615f32c6da: Pull complete </span><br><span class="line">Digest: sha256:36e82f2fa95572be5bb6d7a6cb43bde6c0e120c369506d752ebdd5ae378e21f8</span><br><span class="line">Status: Downloaded newer image for quay.io/container-image/spinnaker-deck:2.7.0-20190123200115</span><br><span class="line">[root@hdss7-200 ~]# docker tag 13cb501943e7 harbor.od.com/spinnaker/deck:v2.7.0</span><br><span class="line">[root@hdss7-200 ~]# docker push harbor.od.com/spinnaker/gate:v1.5.0</span><br><span class="line">The push refers to a repository [harbor.od.com/spinnaker/deck]</span><br><span class="line">37c745de781e: Pushed </span><br><span class="line">6472be60f4ca: Pushed </span><br><span class="line">904c7ac769d2: Pushed </span><br><span class="line">b50cd40f4a93: Pushed </span><br><span class="line">9493909cb400: Pushed </span><br><span class="line">v2.7.0: digest: sha256:bfc65b79405f405d332999bcfb979917e1b6b6824d178efe3ba6cb9f65ba718f size: 1373</span><br></pre></td></tr></table></figure></p>
<h2 id="准备资源配置清单-8"><a href="#准备资源配置清单-8" class="headerlink" title="准备资源配置清单"></a>准备资源配置清单</h2><div class="tabs" id="deck"><ul class="nav-tabs"><li class="tab active"><a href="#deck-1">ConfigMap1</a></li><li class="tab"><a href="#deck-2">ConfigMap2</a></li><li class="tab"><a href="#deck-3">Deployment</a></li><li class="tab"><a href="#deck-4">Service</a></li><li class="tab"><a href="#deck-5">Ingress</a></li></ul><div class="tab-content"><div class="tab-pane active" id="deck-1"><p>vi /root/setttings.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;;</span><br><span class="line"></span><br><span class="line">var apiHost = process.env.API_HOST || &apos;<a href="http://gate&apos;" target="_blank" rel="noopener">http://gate&apos;</a>;</span><br><span class="line">var artifactsEnabled = process.env.ARTIFACTS_ENABLED === &apos;true&apos;;</span><br><span class="line">var artifactsRewriteEnabled = process.env.ARTIFACTS_REWRITE_ENABLED === &apos;true&apos;;</span><br><span class="line">var atlasWebComponentsUrl = process.env.ATLAS_WEB_COMPONENTS_URL;</span><br><span class="line">var authEndpoint = process.env.AUTH_ENDPOINT || apiHost + &apos;/auth/user&apos;;</span><br><span class="line">var authEnabled = process.env.AUTH_ENABLED === &apos;false&apos; ? false : true;</span><br><span class="line">var bakeryDetailUrl =</span><br><span class="line">  process.env.BAKERY_DETAIL_URL || apiHost + &apos;/bakery/logs//&apos;;</span><br><span class="line">var canaryAccount = process.env.CANARY_ACCOUNT || &apos;&apos;;</span><br><span class="line">var canaryEnabled = process.env.CANARY_ENABLED === &apos;false&apos;;</span><br><span class="line">var canaryFeatureDisabled = process.env.CANARY_FEATURE_ENABLED !== &apos;true&apos;;</span><br><span class="line">var canaryStagesEnabled = process.env.CANARY_STAGES_ENABLED === &apos;false&apos;;</span><br><span class="line">var chaosEnabled = process.env.CHAOS_ENABLED === &apos;true&apos; ? true : false;</span><br><span class="line">var debugEnabled = process.env.DEBUG_ENABLED === &apos;false&apos; ? false : true;</span><br><span class="line">var defaultMetricStore = process.env.METRIC_STORE || &apos;atlas&apos;;</span><br><span class="line">var displayTimestampsInUserLocalTime = process.env.DISPLAY_TIMESTAMPS_IN_USER_LOCAL_TIME === &apos;true&apos;;</span><br><span class="line">var dryRunEnabled = process.env.DRYRUN_ENABLED === &apos;true&apos; ? true : false;</span><br><span class="line">var entityTagsEnabled = process.env.ENTITY_TAGS_ENABLED === &apos;true&apos; ? true : false;</span><br><span class="line">var fiatEnabled = process.env.FIAT_ENABLED === &apos;true&apos; ? true : false;</span><br><span class="line">var gremlinEnabled = process.env.GREMLIN_ENABLED === &apos;false&apos; ? false : true;</span><br><span class="line">var iapRefresherEnabled = process.env.IAP_REFRESHER_ENABLED === &apos;true&apos; ? true : false;</span><br><span class="line">var infrastructureEnabled = process.env.INFRA_ENABLED === &apos;true&apos; ? true : false;</span><br><span class="line">var managedPipelineTemplatesV2UIEnabled = process.env.MANAGED_PIPELINE_TEMPLATES_V2_UI_ENABLED === &apos;true&apos;;</span><br><span class="line">var managedServiceAccountsEnabled = process.env.MANAGED_SERVICE_ACCOUNTS_ENABLED === &apos;true&apos;;</span><br><span class="line">var onDemandClusterThreshold = process.env.ON_DEMAND_CLUSTER_THRESHOLD || &apos;350&apos;;</span><br><span class="line">var reduxLoggerEnabled = process.env.REDUX_LOGGER === &apos;true&apos;;</span><br><span class="line">var templatesEnabled = process.env.TEMPLATES_ENABLED === &apos;true&apos;;</span><br><span class="line">var useClassicFirewallLabels = process.env.USE_CLASSIC_FIREWALL_LABELS === &apos;true&apos;;</span><br><span class="line"></span><br><span class="line">window.spinnakerSettings = &#123;</span><br><span class="line">  authEnabled: authEnabled,</span><br><span class="line">  authEndpoint: authEndpoint,</span><br><span class="line">  authTtl: 600000,</span><br><span class="line">  bakeryDetailUrl: bakeryDetailUrl,</span><br><span class="line">  canary: &#123;</span><br><span class="line">    atlasWebComponentsUrl: atlasWebComponentsUrl,</span><br><span class="line">    defaultJudge: &apos;NetflixACAJudge-v1.0&apos;,</span><br><span class="line">    featureDisabled: canaryFeatureDisabled,</span><br><span class="line">    metricsAccountName: canaryAccount,</span><br><span class="line">    metricStore: defaultMetricStore,</span><br><span class="line">    reduxLogger: reduxLoggerEnabled,</span><br><span class="line">    showAllConfigs: true,</span><br><span class="line">    stagesEnabled: canaryStagesEnabled,</span><br><span class="line">    storageAccountName: canaryAccount,</span><br><span class="line">    templatesEnabled: templatesEnabled,</span><br><span class="line">  &#125;,</span><br><span class="line">  checkForUpdates: true,</span><br><span class="line">  debugEnabled: debugEnabled,</span><br><span class="line">  defaultCategory: &apos;Kubernetes&apos;,</span><br><span class="line">  defaultInstancePort: 80,</span><br><span class="line">  defaultProviders: [&apos;kubernetes&apos;],</span><br><span class="line">  defaultTimeZone: process.env.TIMEZONE || &apos;Asia/Shanghai&apos;, // see <a href="http://momentjs.com/timezone/docs/#/data-utilities/" target="_blank" rel="noopener">http://momentjs.com/timezone/docs/#/data-utilities/</a></span><br><span class="line">  feature: &#123;</span><br><span class="line">    artifacts: artifactsEnabled,</span><br><span class="line">    artifactsRewrite: artifactsRewriteEnabled,</span><br><span class="line">    canary: &quot;false&quot;,</span><br><span class="line">    chaosMonkey: &quot;false&quot;,</span><br><span class="line">    displayTimestampsInUserLocalTime: displayTimestampsInUserLocalTime,</span><br><span class="line">    dryRunEnabled: dryRunEnabled,</span><br><span class="line">    entityTags: entityTagsEnabled,</span><br><span class="line">    fiatEnabled: &quot;false&quot;,</span><br><span class="line">    gremlinEnabled: &quot;false&quot;,</span><br><span class="line">    iapRefresherEnabled: iapRefresherEnabled,</span><br><span class="line">    // whether stages affecting infrastructure (like &quot;Create Load Balancer&quot;) should be enabled or not</span><br><span class="line">    infrastructureStages: infrastructureEnabled,</span><br><span class="line">    jobs: false,</span><br><span class="line">    managedPipelineTemplatesV2UI: managedPipelineTemplatesV2UIEnabled,</span><br><span class="line">    managedServiceAccounts: managedServiceAccountsEnabled,</span><br><span class="line">    notifications: false,</span><br><span class="line">    pagerDuty: false,</span><br><span class="line">    pipelineTemplates: false,</span><br><span class="line">    pipelines: true,</span><br><span class="line">    quietPeriod: false,</span><br><span class="line">    roscoMode: false,</span><br><span class="line">    snapshots: false,</span><br><span class="line">    travis: false,</span><br><span class="line">    versionedProviders: true,</span><br><span class="line">    wercker: false,</span><br><span class="line">  &#125;,</span><br><span class="line">  gateUrl: apiHost,</span><br><span class="line">  gitSources: [&apos;stash&apos;, &apos;github&apos;, &apos;bitbucket&apos;, &apos;gitlab&apos;],</span><br><span class="line">  maxPipelineAgeDays: 14,</span><br><span class="line">  newApplicationDefaults: &#123;</span><br><span class="line">    chaosMonkey: false,</span><br><span class="line">  &#125;,</span><br><span class="line">  notifications: &#123;</span><br><span class="line">    bearychat: &#123;</span><br><span class="line">      enabled: false,</span><br><span class="line">    &#125;,</span><br><span class="line">    email: &#123;</span><br><span class="line">      enabled: true,</span><br><span class="line">    &#125;,</span><br><span class="line">    githubStatus: &#123;</span><br><span class="line">      enabled: true,</span><br><span class="line">    &#125;,</span><br><span class="line">    googlechat: &#123;</span><br><span class="line">      enabled: false,</span><br><span class="line">    &#125;,</span><br><span class="line">    pubsub: &#123;</span><br><span class="line">      enabled: false,</span><br><span class="line">    &#125;,</span><br><span class="line">    slack: &#123;</span><br><span class="line">      botName: &apos;spinnakerbot&apos;,</span><br><span class="line">      enabled: true,</span><br><span class="line">    &#125;,</span><br><span class="line">    sms: &#123;</span><br><span class="line">      enabled: false,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  onDemandClusterThreshold: Number(onDemandClusterThreshold),</span><br><span class="line">  pollSchedule: 30000,</span><br><span class="line">  providers: &#123;</span><br><span class="line">    appengine: &#123;</span><br><span class="line">      defaults: &#123;</span><br><span class="line">        account: &apos;my-appengine-account&apos;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    kubernetes: &#123;</span><br><span class="line">      defaults: &#123;</span><br><span class="line">        account: &apos;cluster-admin&apos;,</span><br><span class="line">        apiPrefix: &apos;api/v1/proxy/namespaces/kube-system/services/kubernetes-dashboard/#&apos;,</span><br><span class="line">        instanceLinkTemplate: &apos;/api/v1/proxy/namespaces//pods/&apos;,</span><br><span class="line">        internalDNSNameTemplate: &apos;..svc.cluster.local&apos;,</span><br><span class="line">        namespace: &apos;spinnaker&apos;,</span><br><span class="line">        proxy: &apos;10.9.6.200:6443&apos;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  pagerDuty: &#123;</span><br><span class="line">    required: false,</span><br><span class="line">  &#125;,</span><br><span class="line">  pubsubProviders: [&apos;google&apos;], // TODO(joonlim): Add amazon once it is confirmed that amazon pub/sub works.</span><br><span class="line">  searchVersion: 1,</span><br><span class="line">  triggerTypes: [</span><br><span class="line">    &apos;artifactory&apos;,</span><br><span class="line">    &apos;concourse&apos;,</span><br><span class="line">    &apos;cron&apos;,</span><br><span class="line">    &apos;docker&apos;,</span><br><span class="line">    &apos;git&apos;,</span><br><span class="line">    &apos;jenkins&apos;,</span><br><span class="line">    &apos;pipeline&apos;,</span><br><span class="line">    &apos;pubsub&apos;,</span><br><span class="line">    &apos;travis&apos;,</span><br><span class="line">    &apos;webhook&apos;,</span><br><span class="line">    &apos;wercker&apos;,</span><br><span class="line">  ],</span><br><span class="line">  useClassicFirewallLabels: useClassicFirewallLabels,</span><br><span class="line">  whatsNew: &#123;</span><br><span class="line">    fileName: &apos;news.md&apos;,</span><br><span class="line">    gistId: &apos;32526cd608db3d811b38&apos;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="deck-2"><p>vi /root/spinnaker.conf.gen</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;VirtualHost 0.0.0.0:9000&gt;</span><br><span class="line">  DocumentRoot /opt/deck/html</span><br><span class="line">  ServerName spinnaker.od.com</span><br><span class="line"></span><br><span class="line">  ProxyPass &quot;/gate&quot; &quot;<a href="http://gate" target="_blank" rel="noopener">http://gate</a>&quot; retry=0</span><br><span class="line">  ProxyPassReverse &quot;/gate&quot; &quot;<a href="http://gate" target="_blank" rel="noopener">http://gate</a>&quot;</span><br><span class="line">  ProxyPreserveHost On</span><br><span class="line"></span><br><span class="line">  &lt;Directory &quot;/opt/deck/html/&quot;&gt;</span><br><span class="line">    Require all granted</span><br><span class="line">  &lt;/Directory&gt;</span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="deck-3"><p>vi /data/k8s-yaml/deck/deployment.yaml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app: deck</span><br><span class="line">  name: deck</span><br><span class="line">  namespace: spinnaker</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  revisionHistoryLimit: 7</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: deck</span><br><span class="line">  strategy:</span><br><span class="line">    rollingUpdate:</span><br><span class="line">      maxSurge: 1</span><br><span class="line">      maxUnavailable: 1</span><br><span class="line">    type: RollingUpdate</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: deck</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - image: harbor.od.com/spinnaker/deck:v2.7.0</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        name: deck</span><br><span class="line">        terminationMessagePath: /dev/termination-log</span><br><span class="line">        terminationMessagePolicy: File</span><br><span class="line">        securityContext: </span><br><span class="line">          runAsUser: 0</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - mountPath: /opt/spinnaker/config</span><br><span class="line">          name: deck</span><br><span class="line">      imagePullSecrets:</span><br><span class="line">      - name: harbor</span><br><span class="line">      restartPolicy: Always</span><br><span class="line">      terminationGracePeriodSeconds: 30</span><br><span class="line">      volumes:</span><br><span class="line">      - configMap:</span><br><span class="line">          defaultMode: 420</span><br><span class="line">          name: deck</span><br><span class="line">        name: deck</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="deck-4"><p>vi /data/k8s-yaml/deck/svc.yaml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: deck</span><br><span class="line">  namespace: spinnaker</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - port: 80</span><br><span class="line">    protocol: TCP</span><br><span class="line">    targetPort: 9000</span><br><span class="line">  selector:</span><br><span class="line">    app: deck</span><br><span class="line">  type: ClusterIP</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="deck-5"><p>vi /data/k8s-yaml/deck/ingress.yaml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">kind: Ingress</span><br><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">metadata: </span><br><span class="line">  name: deck</span><br><span class="line">  namespace: spinnaker</span><br><span class="line">spec:</span><br><span class="line">  rules:</span><br><span class="line">  - host: spinnaker.od.com</span><br><span class="line">    http:</span><br><span class="line">      paths:</span><br><span class="line">      - path: /</span><br><span class="line">        backend: </span><br><span class="line">          serviceName: deck</span><br><span class="line">          servicePort: 80</span><br></pre></td></tr></table></figure></div></div></div>
<h2 id="应用资源配置清单-8"><a href="#应用资源配置清单-8" class="headerlink" title="应用资源配置清单"></a>应用资源配置清单</h2><p>任意一台运算节点上：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@hdss7-21 ~]# kubectl create cm deck --from-file=settings.js --from-file=spinnaker.conf.gen -n spinnaker</span><br><span class="line">configmap/deck created</span><br><span class="line">[root@hdss7-21 ~]# kubectl apply -f http://k8s-yaml.od.com/deck/deployment.yaml </span><br><span class="line">deployment.extensions/deck created</span><br><span class="line">[root@hdss7-21 ~]# kubectl apply -f http://k8s-yaml.od.com/deck/svc.yaml </span><br><span class="line">service/deck created</span><br><span class="line">[root@hdss7-21 ~]# kubectl apply -f http://k8s-yaml.od.com/deck/ingress.yaml </span><br><span class="line">ingress/deck created</span><br></pre></td></tr></table></figure></p>

      
    </div>

    

    
    
    

    

    
      
    
    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById(&quot;QR&quot;); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.2yuan.png" alt="Stanley Wang 微信支付">
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.2yuan.png" alt="Stanley Wang 支付宝">
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/12/16/实验文档1：BIND9的安装部署/" rel="next" title="实验文档1：BIND9的安装部署">
                <i class="fa fa-chevron-left"></i> 实验文档1：BIND9的安装部署
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/01/18/实验文档4：kubernetes集群的监控和日志分析/" rel="prev" title="实验文档4：kubernetes集群的监控和日志分析">
                实验文档4：kubernetes集群的监控和日志分析 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Stanley Wang">
            
              <p class="site-author-name" itemprop="name">Stanley Wang</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">21</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">4</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/StanleyWang-GitHub" title="GitHub &rarr; https://github.com/StanleyWang-GitHub" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:stanley.wang.m@qq.com" title="E-Mail &rarr; mailto:stanley.wang.m@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#部署对象式存储minio"><span class="nav-number">1.</span> <span class="nav-text">部署对象式存储minio</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#准备docker镜像"><span class="nav-number">1.1.</span> <span class="nav-text">准备docker镜像</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#准备资源配置清单"><span class="nav-number">1.2.</span> <span class="nav-text">准备资源配置清单</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#解析域名"><span class="nav-number">1.3.</span> <span class="nav-text">解析域名</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#应用资源配置清单"><span class="nav-number">1.4.</span> <span class="nav-text">应用资源配置清单</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#浏览器访问"><span class="nav-number">1.5.</span> <span class="nav-text">浏览器访问</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#部署Redis"><span class="nav-number">2.</span> <span class="nav-text">部署Redis</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#准备docker镜像-1"><span class="nav-number">2.1.</span> <span class="nav-text">准备docker镜像</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#准备资源配置清单-1"><span class="nav-number">2.2.</span> <span class="nav-text">准备资源配置清单</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#应用资源配置清单-1"><span class="nav-number">2.3.</span> <span class="nav-text">应用资源配置清单</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#部署CloudDriver"><span class="nav-number">3.</span> <span class="nav-text">部署CloudDriver</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#准备docker镜像-2"><span class="nav-number">3.1.</span> <span class="nav-text">准备docker镜像</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#准备cluster-admin用户配置"><span class="nav-number">3.2.</span> <span class="nav-text">准备cluster-admin用户配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#准备资源配置清单-2"><span class="nav-number">3.3.</span> <span class="nav-text">准备资源配置清单</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#应用资源配置清单-2"><span class="nav-number">3.4.</span> <span class="nav-text">应用资源配置清单</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#部署Front50"><span class="nav-number">4.</span> <span class="nav-text">部署Front50</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#准备docker镜像-3"><span class="nav-number">4.1.</span> <span class="nav-text">准备docker镜像</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#准备资源配置清单-3"><span class="nav-number">4.2.</span> <span class="nav-text">准备资源配置清单</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#应用资源配置清单-3"><span class="nav-number">4.3.</span> <span class="nav-text">应用资源配置清单</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#浏览器访问-1"><span class="nav-number">4.4.</span> <span class="nav-text">浏览器访问</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#部署Orca"><span class="nav-number">5.</span> <span class="nav-text">部署Orca</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#准备docker镜像-4"><span class="nav-number">5.1.</span> <span class="nav-text">准备docker镜像</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#准备资源配置清单-4"><span class="nav-number">5.2.</span> <span class="nav-text">准备资源配置清单</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#应用资源配置清单-4"><span class="nav-number">5.3.</span> <span class="nav-text">应用资源配置清单</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#部署Echo"><span class="nav-number">6.</span> <span class="nav-text">部署Echo</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#准备docker镜像-5"><span class="nav-number">6.1.</span> <span class="nav-text">准备docker镜像</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#准备资源配置清单-5"><span class="nav-number">6.2.</span> <span class="nav-text">准备资源配置清单</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#应用资源配置清单-5"><span class="nav-number">6.3.</span> <span class="nav-text">应用资源配置清单</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#部署Igor"><span class="nav-number">7.</span> <span class="nav-text">部署Igor</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#准备docker镜像-6"><span class="nav-number">7.1.</span> <span class="nav-text">准备docker镜像</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#准备资源配置清单-6"><span class="nav-number">7.2.</span> <span class="nav-text">准备资源配置清单</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#应用资源配置清单-6"><span class="nav-number">7.3.</span> <span class="nav-text">应用资源配置清单</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#部署Gate"><span class="nav-number">8.</span> <span class="nav-text">部署Gate</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#准备docker镜像-7"><span class="nav-number">8.1.</span> <span class="nav-text">准备docker镜像</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#准备资源配置清单-7"><span class="nav-number">8.2.</span> <span class="nav-text">准备资源配置清单</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#应用资源配置清单-7"><span class="nav-number">8.3.</span> <span class="nav-text">应用资源配置清单</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#部署Deck"><span class="nav-number">9.</span> <span class="nav-text">部署Deck</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#准备docker镜像-8"><span class="nav-number">9.1.</span> <span class="nav-text">准备docker镜像</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#准备资源配置清单-8"><span class="nav-number">9.2.</span> <span class="nav-text">准备资源配置清单</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#应用资源配置清单-8"><span class="nav-number">9.3.</span> <span class="nav-text">应用资源配置清单</span></a></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Stanley Wang</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="站点总字数">385k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
    <span title="站点阅读时长">5:50</span>
  
</div>









        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  
    
    
  
  <script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script>













  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.0"></script>

  <script src="/js/src/motion.js?v=7.0.0"></script>



  
  


  <script src="/js/src/schemes/muse.js?v=7.0.0"></script>




  
  <script src="/js/src/scrollspy.js?v=7.0.0"></script>
<script src="/js/src/post-details.js?v=7.0.0"></script>



  


  <script src="/js/src/bootstrap.js?v=7.0.0"></script>



  


  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
  

  
  

  


  

  

  

  

  

  

  

  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  <script>
    $('.highlight').each(function(i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap');
      $(e).after($wrap);
      $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function(e) {
        var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
          return $(e).text();
        }).toArray().join('\n');
        var ta = document.createElement('textarea');
        var range = document.createRange(); //For Chrome
        var sel = window.getSelection(); //For Chrome
        var yPosition = window.pageYOffset || document.documentElement.scrollTop;
        ta.style.top = yPosition + 'px'; //Prevent page scroll
        ta.style.position = 'absolute';
        ta.style.opacity = '0';
        ta.value = code;
        ta.textContent = code; //For FireFox
        ta.contentEditable = true;
        ta.readOnly = false;
        document.body.appendChild(ta);
        range.selectNode(ta);
        sel.removeAllRanges();
        sel.addRange(range);
        ta.setSelectionRange(0, code.length);
        var result = document.execCommand('copy');
        
          if (result) $(this).text('复制成功');
          else $(this).text('复制失败');
        
        ta.blur(); //For iOS
        $(this).blur();
      })).on('mouseleave', function(e) {
        var $b = $(this).find('.copy-btn');
        setTimeout(function() {
          $b.text('复制');
        }, 300);
      }).append(e);
    })
  </script>


</body>
</html>
